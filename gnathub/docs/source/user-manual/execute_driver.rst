.. include:: ../defines.hrst

How to execute the |Driver| driver
==================================

Getting started
---------------

Execute |Driver| as you would with any other |GNAT| tools, *ie.* by providing a
|GNAT| project file (``.gpr``).

.. code-block:: console

    $ gnathub -P my_project.gpr

This will execute each |Driver| plug-in for the project, collect the results of
each tool, and store those results in its local |SQLite| database.

|SQLite| is a software library that implements a self-contained, serverless,
zero-configuration, transactional SQL database engine. This makes it a perfect
fit for storing and organizing the results of our various analysis and making
them available to a vast range of code quality management platforms.


Project file attributes
-----------------------

The |Driver| driver expects a number of mandatory and optional attributes to be
set from the project file.

General order attributes
^^^^^^^^^^^^^^^^^^^^^^^^

``Plugins``
"""""""""""

The list of plug-ins name to load and execute for this project. This attribute
is ignored is ``--plugins`` is specified on the command line. This list can be
further amended by the use of ``Specific_Plugins`` and ``Plugins_Off``
attributes.

``Specific_Plugins``
""""""""""""""""""""

A list of files containing custom plug-ins implementations to be added to the
execution queue of |Driver|. This is a complementary list of plugins, with means
that it will extend the initial plug-ins list (which is either computed from the
command line input (*via* ``--plugins``, the project file *via* the ``Plugins``
attribute, or the default, *ie.* all plug-ins that can be found in both the
``GNAThub.core_plugins()`` and ``GNAThub.extra_plugins()`` directories).

``Plugins_Off``
"""""""""""""""

A list of plug-ins name to remove from the execution queue if present. This is
useful to disable one or more plug-ins in the context of a specific project.
This filter is applied after the computation of the plug-ins list, *ie.* after
handling all the above.

|SonarQube|-specific attributes
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

``Project_Name``
""""""""""""""""

The name of the project. This is used by the ``sonar-config`` plug-in to
override the default project name provided by the |GNAT| project file.

``Project_Version``
"""""""""""""""""""

The version of the project. This is used by the ``sonar-config`` plug-in to
override the default project version set by the plug-in.

``Project_Key``
"""""""""""""""

The unique key of the project. This is used by the ``sonar-config`` plug-in to
override the default project key generated by the plug-in (from the project's
name). This is a mandatory attribute for |SonarQube| to discriminate between
projects in its database.

``Source_Encoding``
"""""""""""""""""""

The encoding to use to read files from this project. This is used by the
``sonar-config`` plug-in to override the default encoding set to ``UTF-8`` and
forward this value to |SonarQube| (which takes care of fetching and indexing all
source files).


|Driver|'s core plug-ins
------------------------

|Product|'s driver comes with a set of **core** plug-ins, allowing quick
integration with a software development teamâ€™s workflow.

The following tools are currently supported by the |Driver|'s **core** plugins:

+--------------+-----------------+--------------------------------------------+
| **Tool**     | **Plugin name** | **Description**                            |
+--------------+-----------------+--------------------------------------------+
| |GNATmetric| | gnatmetric      | Execute |GNATmetric| and parse the results |
+--------------+-----------------+--------------------------------------------+
| |GNATcheck|  | gnatcheck       | Execute |GNATcheck| and parse the results  |
+--------------+-----------------+--------------------------------------------+
| |GNATprove|  | gnatprove       | Execute |GNATprove| and parse the results  |
+--------------+-----------------+--------------------------------------------+
| |CodePeer|   | codepeer        | Execute |CodePeer| and ``msg-reader`` and  |
|              |                 | parse the results                          |
+--------------+-----------------+--------------------------------------------+
| |Gcov|       | gcov            | Parse the ``.gcov`` files                  |
+--------------+-----------------+--------------------------------------------+


|Driver|'s extra plug-ins
-------------------------

An additional **extra** folder is available for the user to store its plugins.
|Driver| will walk this directory looking for additional plugins to load. This
directory will never be overridden by an update which makes it a good fit to
store users' custom plug-ins.


|Driver|'s command line
-----------------------

Several switches are available to tune each execution of the driver from the
command line. Please use ``gnathub --help`` for the full list of supported
switches.

``--plugins``
^^^^^^^^^^^^^

This switch expects a comma-separated list of plug-ins name as argument. This
list is used as initial execution queue by the driver, by-passing the initial
list of plug-ins computed from the project attribute ``Plugins`` and the
available ones in both the **core** and **extra** plug-ins directories.

However, the project attribute ``Plugins_Off`` still apply on top of that list
to remove any explicitely disabled plug-in.

``--exec``
^^^^^^^^^^

This switch expects a Python file as argument. Contrary to its default behavior,
when ``--exec`` is provided, |Driver| will keep any previous database (instead
of reseting it), and execute the input Python file. This allows for
post-processing, possibly on the local database (through the exposed Python
API).

``--jobs``
^^^^^^^^^^

Specify the maximum number of processes allowed to be executed at the same time.
Mimics Makefile's ``-j`` switch. ``0`` is a special value meaning "*as many
processes as possible*". Default value is ``1``.
